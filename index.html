<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Schole Reset Password</title>
  </head>
  <script>
    function parseQueryString(queryString) {
      const params = {};
      window.location.search
        .substr(1)
        .split("&")
        .forEach((item) => {
          const query = item.split("=");
          params[query[0]] = query[1];
        });

      return params;
    }

    const queryParams = parseQueryString(window.location.search.substr(1));

    const baseURL = "http://schole-web.sonix.vn/update-password";
    const token =
      queryParams["token"] ??
      "53d72f65ed9d466650efacfa47620adb0e61cf6983ce80271364e9fa59195bc0";
    const email = queryParams["email"] ?? "tqloc0311@gmail.com";
    const urlWithParams = `http://schole-web.sonix.vn/update-password?token=${token}&email=${email}`;

    const devQuery = window.location.search.substr(1).split("=")[1];

    // cần thêm param "dev": boolean | undefined vào API forget-password
    // false: mobile development environment
    // true: mobile production environment
    // undefined: web
    const dev = devQuery && devQuery != 0;

    // format: :scheme/reset-password/:token/:email
    // scheme:
    //      dev: exp://exp.host/@sonix/schole/--/
    //      prod: schole:///
    const deepLinkDev = `exp://exp.host/@sonix/schole/--/reset-password/${token}/${email}`;
    const deepLinkProd = `schole:///reset-password/${token}/${email}`;

    function onLoad() {
      document.getElementById("link").innerHTML = urlWithParams;
      document.getElementById("test").innerHTML = dev;

      const devTag = document.getElementById("deepLinkDev");
      devTag.innerHTML = deepLinkDev;
      devTag.href = deepLinkDev;
      const prodTag = document.getElementById("deepLinkProd");
      prodTag.innerHTML = deepLinkProd;
      prodTag.href = deepLinkProd;
    }

    function linkClickedHandler() {
      const deepLink = dev ? deepLinkDev : deepLinkProd;

      if (dev !== undefined) {
        window.location.replace(deepLink);

        setTimeout(function () {
          window.location.href = urlWithParams;
        }, 2000);
      } else {
        window.location.href = urlWithParams;
      }
    }
  </script>

  <body onload="onLoad()">
    <div>
      <h1>【スコーレ】パスワード再設定のご案内</h1>
      <h2>こちらのURLからパスワードを再設定してください。</h2>
      <h3 id="test"></h3>
      <h3>
        <a id="link" href="#" onclick="linkClickedHandler()"></a>
      </h3>
      <h3><a id="deepLinkDev"></a></h3>
      <h3><a id="deepLinkProd"></a></h3>
      <h3>
        URL の有効期限は 24 時間です。<br />
        有効期限が切れた場合は最初からお手続きをお願いします。<br /><br />
        ※本メールは送信専用アドレスから配信されております。<br />
        このメールにご返信いただくことはでませんのでご注意ください。<br />
        ※本メールに心当たりのない方はこのままメールを破棄してください。<br /><br />
        スコーレ家庭教育振興協会
      </h3>
    </div>
  </body>
</html>
